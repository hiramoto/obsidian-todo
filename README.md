# Kozane Journal

Obsidian 用の作業時間記録・タスク管理プラグイン。

タスクごとの作業開始・終了を記録し、デイリーノートに自動でログを残します。ステータスバーに予定終了時刻を表示し、サイドバーから期間別の集計を確認できます。

> **「こざね」とは？**
> 民族学者・梅棹忠夫が著書『知的生産の技術』（1969）で紹介した「こざね法」に由来します。こざね法は、思いついたことを一枚ずつ小さな紙片（こざね）に書き出し、それを並べ替えながら構造化していく発想整理の手法です。
> このプラグインも、日々の作業を一つずつ記録し、積み重ねたログを集計・俯瞰できるようにするという点で、こざね法の精神を受け継いでいます。

## 主な機能

### タスク追加

- **タスク追加**: コマンドパレットからタスクファイルを新規作成
- タスクフォルダに `YYYYMMDD-タスク名.md` として作成し、自動で開く
- 設定で定義したデフォルトフロントマターが自動挿入される
- モーダルから追加のフロントマターを任意で入力可能
- フロントマター内で日付式が使える:

| 記法 | 意味 | 例 |
|------|------|------|
| `{{date}}` | 今日の日付 | `2026-02-12` |
| `{{date+1d}}` | 1 日後 | `2026-02-13` |
| `{{date+1w}}` | 1 週間後 | `2026-02-19` |
| `{{date+2m}}` | 2 ヶ月後 | `2026-04-12` |
| `{{date+1y}}` | 1 年後 | `2027-02-12` |
| `{{title}}` | タスク名 | 入力した値 |

### 作業の記録

- **作業開始**: コマンドパレットからタスクを選択して作業を開始（ファジー検索対応）
- **作業終了**: 終了時にメモを添えて記録。デイリーノートの LOG セクションに自動追記
- 時刻は設定した間隔（デフォルト 5 分）で丸め処理
- PLAN の予定時間は `60min` または `1h` 形式で記述可能
- 取り消し線（`~~テキスト~~`）で囲んだ PLAN 行は予定から自動除外

### ステータスバー

- デイリーノートの PLAN / LOG セクションから予定終了時刻を自動算出
- `⏰ 予定終了: HH:MM (残り: Xh XXm)` 形式でリアルタイム表示
- 作業中はタスク名と経過時間を `🕐 タスク名 HH:mm` 形式で表示（10 秒ごとに更新）
- 昼休み（デフォルト 12:00–13:00）を予定終了時刻の計算から自動除外
- PLAN に含まれるタスクの実績のみを残り時間の計算に使用
- ファイル変更時に自動更新

### タスク履歴の自動表示

- タスクフォルダ内のファイルを開くと、過去の作業履歴をテーブルで自動表示
- ファイル名でタスクを識別（フロントマターの `task_id` は不要）
- 累計作業時間・作業日数も表示
- ファイルを直接変更せず、Post Processor で読み取り専用描画

### サイドバー集計ビュー

- **日付選択タブ**: 「今日」ボタンまたはカレンダーから任意の日付を選んで集計
- **期間選択タブ**: 今週 / 先週 / 今月 / 先月のクイックボタン、または開始日・終了日を自由に指定
- タスクごとの作業時間の内訳
- 期間ビューでは作業日数も表示
- **着手予定タスク**（今日タブ）: PLAN セクションのタイムスロット（`### スロット名 HH:MM-HH:MM`）を解析し、現在のスロットと 30 分以内に開始するスロットのタスクを表示
- **タスク別 予定 vs 実績**（今日タブ）: PLAN の予定時間と LOG の実績時間をタスクごとに比較表示（残り / 超過 / 完了 / 未着手）。計画外タスクも別枠で表示

## Vault の構成例

タスクフォルダ・デイリーフォルダの名前は設定で自由に変更できます（デフォルト: `5-tasks`、`2-daily`）。

```
vault/
├── 5-tasks/           # タスクフォルダ（設定で変更可）
│   ├── 20260211-API実装.md
│   └── 20260211-レビュー対応.md
├── 2-daily/           # デイリーフォルダ（設定で変更可）
│   ├── 2026-02-10.md
│   └── 2026-02-11.md
└── ...
```

### タスクファイル

タスクフォルダ内の `.md` ファイルが作業開始時の選択対象になります。フロントマターに `status: in-progress` があるタスクは一覧の先頭に表示されます。タスクはファイル名で識別されるため、フロントマターに `task_id` を設定する必要はありません。

```yaml
---
status: in-progress
created: 2026-02-11
tags: [project/backend]
---
```

### デイリーノート

PLAN セクションと LOG セクションを持つ Markdown ファイルです。作業終了時に LOG セクションへ自動追記されます。デイリーノートが存在しない場合は自動作成されます。

```markdown
# 2026-02-11

## PLAN
### 午前1 09:00-12:00
- [[20260211-API実装]] / エンドポイント設計 90min
- [[20260211-ドキュメント作成]] / README更新 1h
### 午後1 13:00-15:00
- [[20260211-テスト]] 2h
- ~~[[20260211-レビュー対応]] / コードレビュー 30min~~

---

## LOG
- 08:15-09:20 [[20260211-API実装]] / メモ

---

## メモ
```

> **タイムスロットについて**: `### スロット名 HH:MM-HH:MM` 形式のヘッダーは任意です。記述するとサイドバーの「着手予定」に現在・直近のタスクが表示されます。省略した場合は従来どおりフラットなリストとして扱われます。

## 設定

すべての項目はプラグイン設定画面から変更できます。

| 項目 | デフォルト | 説明 |
|------|-----------|------|
| タスクフォルダ | `5-tasks` | タスクファイルの格納先（任意のフォルダ名に変更可） |
| デイリーフォルダ | `2-daily` | デイリーノートの格納先（任意のフォルダ名に変更可） |
| PLAN セクション名 | `PLAN` | 予定セクションの見出し |
| LOG セクション名 | `LOG` | 記録セクションの見出し |
| デイリーノート形式 | `YYYY-MM-DD` | ファイル名の日付フォーマット |
| 時刻丸め間隔 | `5` 分 | 開始・終了時刻の丸め単位 |
| ステータスバー表示 | ON | 予定終了時刻の表示切替 |
| 履歴の自動表示 | ON | タスクファイルへの履歴描画切替 |
| 昼休み開始 | `12:00` | 予定終了時刻の計算で除外する休憩開始時刻 |
| 昼休み終了 | `13:00` | 予定終了時刻の計算で除外する休憩終了時刻 |
| デフォルトフロントマター | (下記参照) | タスク追加時に自動挿入されるフロントマター（YAML 形式、日付式対応） |

デフォルトフロントマターの初期値:

```yaml
status: not-started
created: {{date}}
review_date: {{date+1w}}
due_date:
tags: []
```

## インストール

### 手動インストール

1. リリースページから `main.js`、`manifest.json`、`styles.css` をダウンロード
2. Vault の `.obsidian/plugins/kozane-journal/` フォルダにコピー
3. Obsidian の設定 → コミュニティプラグインから Kozane Journal を有効化

### ビルド

```bash
npm install
npm run build
```

## ライセンス

MIT
